[
  {
    "query": "SELECT u.state, SUM(oi.sale_price) AS total_revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id JOIN `bigquery-public-data.thelook_ecommerce.users` u ON o.user_id = u.id GROUP BY u.state ORDER BY total_revenue DESC",
    "description": "This query calculates the total revenue for sales, grouped by the state of the users who made the purchases. It then orders these states by their total revenue in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 276,
    "completion_tokens": 289,
    "total_tokens": 1302
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(ii.id) AS sold_items FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.products` p ON ii.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON ii.product_distribution_center_id = dc.id WHERE ii.sold_at IS NOT NULL GROUP BY distribution_center_id, dc.name ORDER BY sold_items DESC",
    "description": "This query calculates the total number of sold inventory items for each distribution center. It groups the results by distribution center ID and name, then orders them by the count of sold items in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 303,
    "completion_tokens": 302,
    "total_tokens": 1789
  },
  {
    "query": "SELECT o.order_id, SUM(ii.cost) AS total_cost, SUM(oi.sale_price) AS total_revenue, SUM(oi.sale_price) - SUM(ii.cost) AS profit FROM `bigquery-public-data.thelook_ecommerce.orders` o JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.order_id = o.order_id JOIN `bigquery-public-data.thelook_ecommerce.inventory_items` ii ON oi.inventory_item_id = ii.id GROUP BY o.order_id ORDER BY profit DESC",
    "description": "This query calculates the total cost, total revenue, and net profit for each individual order. It then lists these orders, sorted by their profit in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.inventory_items\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"inventory_item_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 311,
    "completion_tokens": 295,
    "total_tokens": 1436
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(ii.id) AS num_items FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON ii.product_distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY num_items DESC",
    "description": "This query calculates the total number of inventory items associated with each distribution center. It lists the distribution center's ID and name along with the count of items it manages.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 267,
    "completion_tokens": 195,
    "total_tokens": 853
  },
  {
    "query": "SELECT p.id AS product_id, p.name, COUNT(DISTINCT o.order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY product_id, p.name ORDER BY num_orders DESC",
    "description": "This query calculates the total number of unique orders each product has appeared in. It lists each product's ID and name, along with the count of distinct orders, ordered from most ordered to least ordered.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 290,
    "completion_tokens": 298,
    "total_tokens": 1651
  },
  {
    "query": "SELECT p.id AS product_id, p.name, COUNT(e.id) AS total_events FROM `bigquery-public-data.thelook_ecommerce.events` e JOIN `bigquery-public-data.thelook_ecommerce.users` u ON e.user_id = u.id JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.user_id = u.id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY product_id, p.name ORDER BY total_events DESC",
    "description": "This query calculates the total number of events associated with each product. It links events to users, users to order items, and order items to products to aggregate event counts per product.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 311,
    "completion_tokens": 391,
    "total_tokens": 2129
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(DISTINCT p.id) AS num_products FROM `bigquery-public-data.thelook_ecommerce.products` p JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY num_products DESC",
    "description": "This query counts the number of unique products associated with each distribution center. It retrieves the distribution center's ID, name, and the total count of distinct products linked to it, ordered by the number of products in descending order.",
    "tables": "[\"`bigquery-public-data.thelook_ecommerce.products`\", \"`bigquery-public-data.thelook_ecommerce.distribution_centers`\"]",
    "joins": "[{\"left_table\": \"`bigquery-public-data.thelook_ecommerce.products`\", \"left_column\": \"distribution_center_id\", \"right_table\": \"`bigquery-public-data.thelook_ecommerce.distribution_centers`\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 265,
    "completion_tokens": 205,
    "total_tokens": 885
  },
  {
    "query": "SELECT u.gender, p.category, SUM(oi.sale_price) AS total_revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.users` u ON oi.user_id = u.id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY u.gender, p.category ORDER BY total_revenue DESC",
    "description": "This query calculates the total revenue generated, grouped by user gender and product category. It aggregates sales data from order items, joining with user and product information to categorize the revenue.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 282,
    "completion_tokens": 290,
    "total_tokens": 1429
  },
  {
    "query": "SELECT user_id, MIN(DATE(created_at)) AS first_order_date FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ORDER BY first_order_date",
    "description": "This query retrieves the unique user ID and the date of their very first order from the orders table. It groups the results by user ID and sorts them by the first order date.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[]",
    "prompt_tokens": 220,
    "completion_tokens": 82,
    "total_tokens": 615
  },
  {
    "query": "SELECT user_id, order_id, created_at, ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY created_at) AS order_number FROM `bigquery-public-data.thelook_ecommerce.orders` ORDER BY user_id, order_number",
    "description": "This query retrieves user and order information, then assigns a sequential order number to each order for every user, based on the order's creation date. The final results are sorted by user ID and their assigned order number.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[]",
    "prompt_tokens": 233,
    "completion_tokens": 90,
    "total_tokens": 627
  },
  {
    "query": "SELECT user_id, total_spent, DENSE_RANK() OVER (ORDER BY total_spent DESC) AS spend_rank FROM ( SELECT u.id AS user_id, SUM(oi.sale_price) AS total_spent FROM `bigquery-public-data.thelook_ecommerce.users` u LEFT JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.user_id = u.id GROUP BY user_id ) sub ORDER BY spend_rank LIMIT 20",
    "description": "This query calculates the total amount spent by each user and then ranks them based on their spending. It returns the top 20 users by spend rank, showing their user ID, total amount spent, and their dense rank.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 286,
    "completion_tokens": 198,
    "total_tokens": 893
  },
  {
    "query": "WITH ordered_orders AS ( SELECT user_id, created_at, ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY created_at) AS rn FROM `bigquery-public-data.thelook_ecommerce.orders` ) SELECT a.user_id, DATE_DIFF( (SELECT created_at FROM ordered_orders b WHERE b.user_id=a.user_id AND b.rn=2), (SELECT created_at FROM ordered_orders c WHERE c.user_id=a.user_id AND c.rn=1), DAY ) AS days_between FROM ( SELECT DISTINCT user_id FROM ordered_orders WHERE rn >= 2 ) a ORDER BY days_between",
    "description": "This query calculates the number of days between a user's first and second order. It identifies users who have placed at least two orders and then computes the time difference between their initial two purchases.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[]",
    "prompt_tokens": 323,
    "completion_tokens": 85,
    "total_tokens": 1098
  },
  {
    "query": "SELECT order_date, num_orders, SUM(num_orders) OVER (ORDER BY order_date) AS running_total FROM ( SELECT DATE(created_at) AS order_date, COUNT(*) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY order_date ) ORDER BY order_date",
    "description": "This query calculates the daily number of orders and then computes a running total of orders based on the order date. It aggregates orders by date and then applies a window function for cumulative summation.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[]",
    "prompt_tokens": 247,
    "completion_tokens": 83,
    "total_tokens": 575
  },
  {
    "query": "WITH user_brand_spend AS ( SELECT u.id AS user_id, p.brand, SUM(oi.sale_price) AS brand_spend, RANK() OVER (PARTITION BY u.id ORDER BY SUM(oi.sale_price) DESC) AS rnk FROM `bigquery-public-data.thelook_ecommerce.users` u JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.user_id = u.id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY user_id, p.brand ) SELECT user_id, brand AS top_brand, brand_spend FROM user_brand_spend WHERE rnk = 1 ORDER BY brand_spend DESC",
    "description": "This query identifies the top-spending brand for each user. It first calculates the total spend per user per brand, then uses a ranking window function to find the highest-spending brand for each individual user.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 347,
    "completion_tokens": 296,
    "total_tokens": 1407
  },
  {
    "query": "SELECT product_id, inventory_item_id, sale_price, LAG(sale_price) OVER (PARTITION BY product_id ORDER BY created_at) AS previous_sale_price, sale_price - LAG(sale_price) OVER (PARTITION BY product_id ORDER BY created_at) AS sale_price_diff FROM `bigquery-public-data.thelook_ecommerce.order_items` ORDER BY product_id, created_at LIMIT 100",
    "description": "This query retrieves product sales information, calculating the previous sale price and the difference between the current and previous sale price for each product, ordered by product and creation date, limited to 100 results.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[]",
    "prompt_tokens": 277,
    "completion_tokens": 89,
    "total_tokens": 671
  },
  {
    "query": "SELECT user_id, created_at, LAG(created_at) OVER (PARTITION BY user_id ORDER BY created_at) AS previous_event_time, TIMESTAMP_DIFF(created_at, LAG(created_at) OVER (PARTITION BY user_id ORDER BY created_at), SECOND) AS seconds_since_prior_event FROM `bigquery-public-data.thelook_ecommerce.events` ORDER BY user_id, created_at LIMIT 100",
    "description": "This query calculates the timestamp of the previous event and the time difference in seconds between consecutive events for each user. It partitions events by user and orders them by creation time to determine the sequence.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\"]",
    "joins": "[]",
    "prompt_tokens": 277,
    "completion_tokens": 84,
    "total_tokens": 533
  },
  {
    "query": "WITH user_daily AS ( SELECT oi.user_id, DATE(o.created_at) AS order_date, SUM(oi.sale_price) AS daily_revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id GROUP BY oi.user_id, order_date ) SELECT user_id, order_date, daily_revenue, SUM(daily_revenue) OVER (PARTITION BY user_id ORDER BY order_date) AS cumulative_revenue FROM user_daily ORDER BY user_id, order_date",
    "description": "This query first calculates the daily revenue for each user by summing sale prices from order items. It then computes the cumulative revenue for each user over time, based on their daily revenue.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 321,
    "completion_tokens": 191,
    "total_tokens": 871
  },
  {
    "query": "SELECT distribution_center_id, name, total_cost, RANK() OVER (ORDER BY total_cost DESC) AS cost_rank FROM ( SELECT dc.id AS distribution_center_id, dc.name, SUM(ii.cost) AS total_cost FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc JOIN `bigquery-public-data.thelook_ecommerce.inventory_items` ii ON ii.product_distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ) sub ORDER BY cost_rank",
    "description": "This query calculates the total cost of inventory items for each distribution center. It then ranks these distribution centers based on their total cost in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"bigquery-public-data.thelook_ecommerce.inventory_items\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"right_column\": \"product_distribution_center_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 298,
    "completion_tokens": 190,
    "total_tokens": 907
  },
  {
    "query": "SELECT order_id, id AS order_item_id, sale_price, ROW_NUMBER() OVER (PARTITION BY order_id ORDER BY sale_price DESC) AS item_position FROM `bigquery-public-data.thelook_ecommerce.order_items` ORDER BY order_id, item_position LIMIT 100",
    "description": "This query retrieves order item details, including their ID, sale price, and a sequential position within each order based on the highest sale price. It then orders the results by order ID and item position, limiting the output to 100 records.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[]",
    "prompt_tokens": 245,
    "completion_tokens": 98,
    "total_tokens": 601
  },
  {
    "query": "SELECT id AS order_item_id, shipped_at, delivered_at, TIMESTAMP_DIFF(delivered_at, shipped_at, HOUR) AS hours_in_transit FROM `bigquery-public-data.thelook_ecommerce.order_items` WHERE shipped_at IS NOT NULL AND delivered_at IS NOT NULL ORDER BY hours_in_transit DESC LIMIT 100",
    "description": "This query retrieves order item IDs, shipment, and delivery timestamps, and calculates the total hours an item was in transit. It specifically targets items with both shipment and delivery dates, ordering the results to show the 100 items with the longest transit times.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[]",
    "prompt_tokens": 255,
    "completion_tokens": 100,
    "total_tokens": 697
  },
  {
    "query": "WITH daily_rev AS ( SELECT DATE(created_at) AS order_date, SUM(sale_price) AS daily_revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id GROUP BY order_date ) SELECT order_date, daily_revenue, AVG(daily_revenue) OVER (ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS moving_avg_7d FROM daily_rev ORDER BY order_date",
    "description": "This query calculates the total daily revenue and then computes a 7-day moving average of this daily revenue. It aggregates order item sales by date from a join between order items and orders.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 304,
    "completion_tokens": 193,
    "total_tokens": 1024
  },
  {
    "query": "SELECT category, sale_price, NTILE(10) OVER (PARTITION BY category ORDER BY sale_price) AS decile FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id ORDER BY category, sale_price DESC LIMIT 200",
    "description": "This query retrieves product categories, their sale prices, and calculates a decile rank for each sale price within its respective product category. It joins order item details with product information to achieve this ranking and returns the top 200 results ordered by category and sale price.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 260,
    "completion_tokens": 207,
    "total_tokens": 860
  },
  {
    "query": "WITH monthly_revenue AS ( SELECT EXTRACT(YEAR FROM o.created_at) AS yr, EXTRACT(MONTH FROM o.created_at) AS mon, p.category, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY yr, mon, p.category ) SELECT yr, mon, category, revenue FROM ( SELECT *, DENSE_RANK() OVER (PARTITION BY yr, mon ORDER BY revenue DESC) AS rnk FROM monthly_revenue ) t WHERE rnk <= 3 ORDER BY yr, mon, revenue DESC",
    "description": "This query calculates the total monthly revenue for each product category and then identifies the top 3 highest-earning categories for each month and year.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 360,
    "completion_tokens": 286,
    "total_tokens": 1349
  },
  {
    "query": "WITH user_first_order AS ( SELECT user_id, MIN(created_at) AS first_order_at FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ), user_first_event AS ( SELECT user_id, MIN(created_at) AS first_event_at FROM `bigquery-public-data.thelook_ecommerce.events` GROUP BY user_id ) SELECT e.traffic_source, COUNT(DISTINCT CASE WHEN o.first_order_at <= TIMESTAMP_ADD(e.created_at, INTERVAL 7 DAY) THEN e.user_id END) AS converters, COUNT(DISTINCT e.user_id) AS total_users, SAFE_DIVIDE( COUNT(DISTINCT CASE WHEN o.first_order_at <= TIMESTAMP_ADD(e.created_at, INTERVAL 7 DAY) THEN e.user_id END), COUNT(DISTINCT e.user_id) ) AS conversion_rate FROM `bigquery-public-data.thelook_ecommerce.events` e LEFT JOIN user_first_order o ON e.user_id = o.user_id GROUP BY e.traffic_source ORDER BY conversion_rate DESC",
    "description": "This query calculates the 7-day conversion rate for users based on their initial traffic source. It determines the percentage of distinct users who placed their first order within seven days of any recorded event, grouped by the traffic source of those events.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 435,
    "completion_tokens": 199,
    "total_tokens": 1854
  },
  {
    "query": "WITH ordered_orders AS ( SELECT user_id, created_at, ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY created_at) AS rn FROM `bigquery-public-data.thelook_ecommerce.orders` ) SELECT COUNT(*) AS repeat_customers FROM ( SELECT user_id FROM ordered_orders WHERE rn = 2 AND created_at <= TIMESTAMP_ADD((SELECT created_at FROM ordered_orders o2 WHERE o2.user_id = ordered_orders.user_id AND o2.rn = 1), INTERVAL 30 DAY) ) t",
    "description": "This query identifies and counts repeat customers who placed their second order within 30 days of their first order. It first ranks each user's orders by creation date to find their first and second orders.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[]",
    "prompt_tokens": 298,
    "completion_tokens": 87,
    "total_tokens": 971
  },
  {
    "query": "WITH weekly_rev AS ( SELECT EXTRACT(YEAR FROM o.created_at) AS yr, EXTRACT(WEEK FROM o.created_at) AS wk, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id GROUP BY yr, wk ) SELECT yr, wk, revenue, LAG(revenue) OVER (ORDER BY yr, wk) AS prev_week_revenue, SAFE_DIVIDE(revenue - LAG(revenue) OVER (ORDER BY yr, wk), LAG(revenue) OVER (ORDER BY yr, wk)) AS wo_w_growth FROM weekly_rev ORDER BY yr, wk",
    "description": "This query first calculates the total revenue for each week of each year. Then, it computes the previous week's revenue and the week-over-week revenue growth percentage based on these weekly totals.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 344,
    "completion_tokens": 195,
    "total_tokens": 1426
  },
  {
    "query": "WITH first_order AS ( SELECT user_id, MIN(created_at) AS first_order_at FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ) SELECT u.id AS user_id, DATE_DIFF(DATE(f.first_order_at), DATE(u.created_at), DAY) AS days_to_first_order FROM `bigquery-public-data.thelook_ecommerce.users` u LEFT JOIN first_order f ON u.id = f.user_id WHERE f.first_order_at IS NOT NULL ORDER BY days_to_first_order",
    "description": "This query calculates the number of days it takes for each user to place their first order. It joins user creation dates with their earliest order dates to determine the time elapsed for first-time purchases.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 312,
    "completion_tokens": 188,
    "total_tokens": 3419
  },
  {
    "query": "SELECT p.category, COUNTIF(oi.returned_at IS NOT NULL) AS returned_items, COUNT(*) AS total_items, SAFE_DIVIDE(COUNTIF(oi.returned_at IS NOT NULL), COUNT(*)) AS return_rate FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY p.category ORDER BY return_rate DESC",
    "description": "This query calculates the return rate for each product category by joining order item details with product information. It counts the total number of items and the number of returned items, then computes their ratio.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 283,
    "completion_tokens": 191,
    "total_tokens": 1148
  },
  {
    "query": "SELECT status, AVG(TIMESTAMP_DIFF(delivered_at, created_at, HOUR)) AS avg_hours_from_order_to_delivery FROM ( SELECT o.order_id, o.status, o.created_at, MIN(oi.delivered_at) AS delivered_at FROM `bigquery-public-data.thelook_ecommerce.orders` o JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.order_id = o.order_id WHERE oi.delivered_at IS NOT NULL GROUP BY o.order_id, o.status, o.created_at ) GROUP BY status ORDER BY avg_hours_from_order_to_delivery",
    "description": "This query calculates the average time in hours from order creation to the earliest delivery for each order. It groups these averages by order status.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 326,
    "completion_tokens": 182,
    "total_tokens": 1169
  },
  {
    "query": "WITH first_order AS ( SELECT user_id, MIN(created_at) AS first_order_at FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ) SELECT u.id AS user_id, COUNT(e.id) AS events_before_first_order FROM `bigquery-public-data.thelook_ecommerce.users` u JOIN `bigquery-public-data.thelook_ecommerce.events` e ON e.user_id = u.id LEFT JOIN first_order f ON u.id = f.user_id WHERE e.created_at < f.first_order_at GROUP BY user_id ORDER BY events_before_first_order DESC",
    "description": "Error generating metadata: 504 Deadline Exceeded",
    "tables": [],
    "joins": [],
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0
  },
  {
    "query": "WITH cohort AS ( SELECT u.id AS user_id, DATE(u.created_at) AS cohort_date FROM `bigquery-public-data.thelook_ecommerce.users` u ), revenue AS ( SELECT oi.user_id, DATE(o.created_at) AS order_date, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id GROUP BY oi.user_id, order_date ) SELECT cohort_date, SUM(CASE WHEN order_date <= DATE_ADD(cohort_date, INTERVAL 30 DAY) THEN revenue ELSE 0 END) AS revenue_first_30_days FROM cohort LEFT JOIN revenue r ON cohort.user_id = r.user_id GROUP BY cohort_date ORDER BY cohort_date LIMIT 60",
    "description": "This query calculates the total revenue generated by users within their first 30 days, grouped by their initial signup (cohort) date. It identifies user creation dates and aggregates order revenue to analyze early user performance, limiting the output to the first 60 cohort dates.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 384,
    "completion_tokens": 311,
    "total_tokens": 2677
  },
  {
    "query": "WITH order_counts AS ( SELECT user_id, COUNT(order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ), age_group AS ( SELECT id AS user_id, CASE WHEN age < 25 THEN '<25' WHEN age BETWEEN 25 AND 34 THEN '25-34' WHEN age BETWEEN 35 AND 44 THEN '35-44' WHEN age BETWEEN 45 AND 54 THEN '45-54' ELSE '55+' END AS age_group FROM `bigquery-public-data.thelook_ecommerce.users` ) SELECT age_group, COUNTIF(oc.num_orders > 1) AS repeat_customers, COUNT(*) AS total_customers, SAFE_DIVIDE(COUNTIF(oc.num_orders > 1), COUNT(*)) AS repeat_rate FROM age_group ag LEFT JOIN order_counts oc ON ag.user_id = oc.user_id GROUP BY age_group ORDER BY repeat_rate DESC",
    "description": "This query calculates the repeat customer rate for different age groups. It first counts the number of orders per user and categorizes users into age bands, then joins this information to determine the proportion of customers with more than one order within each age group.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"LEFT\"}]",
    "prompt_tokens": 408,
    "completion_tokens": 197,
    "total_tokens": 1866
  },
  {
    "query": "SELECT order_id, created_at AS order_created_at, returned_at, DATE_DIFF(DATE(returned_at), DATE(created_at), DAY) AS days_to_return FROM `bigquery-public-data.thelook_ecommerce.order_items` WHERE returned_at IS NOT NULL AND DATE_DIFF(DATE(returned_at), DATE(created_at), DAY) <= 14 ORDER BY days_to_return LIMIT 100",
    "description": "This query retrieves order details for items that have been returned within 14 days of their creation date. It calculates the number of days taken to return the item and returns the top 100 items with the fastest return times.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[]",
    "prompt_tokens": 276,
    "completion_tokens": 95,
    "total_tokens": 658
  },
  {
    "query": "WITH user_orders AS ( SELECT user_id, COUNT(order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ), user_events AS ( SELECT user_id, COUNT(id) AS num_events FROM `bigquery-public-data.thelook_ecommerce.events` GROUP BY user_id ) SELECT u.id AS user_id, SAFE_DIVIDE(e.num_events, o.num_orders) AS events_per_order FROM `bigquery-public-data.thelook_ecommerce.users` u LEFT JOIN user_orders o ON u.id = o.user_id LEFT JOIN user_events e ON u.id = e.user_id WHERE o.num_orders > 0 ORDER BY events_per_order DESC",
    "description": "This query calculates the ratio of events per order for each user. It first aggregates the number of orders and events per user, then joins these counts with user information to compute and rank the events per order for users who have placed at least one order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 354,
    "completion_tokens": 299,
    "total_tokens": 2174
  },
  {
    "query": "WITH user_day_revenue AS ( SELECT oi.user_id, DATE(o.created_at) AS order_date, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id GROUP BY oi.user_id, order_date ) SELECT user_id, order_date, revenue FROM user_day_revenue ORDER BY revenue DESC LIMIT 100",
    "description": "This query calculates the total daily revenue for each user by summing sale prices from order items and then retrieves the top 100 users based on their highest single-day revenue.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 296,
    "completion_tokens": 191,
    "total_tokens": 931
  },
  {
    "query": "WITH age_group AS ( SELECT id AS user_id, CASE WHEN age < 25 THEN '<25' WHEN age BETWEEN 25 AND 34 THEN '25-34' WHEN age BETWEEN 35 AND 44 THEN '35-44' WHEN age BETWEEN 45 AND 54 THEN '45-54' ELSE '55+' END AS age_group FROM `bigquery-public-data.thelook_ecommerce.users` ) SELECT e.traffic_source, ag.age_group, SUM(oi.sale_price) AS total_revenue FROM `bigquery-public-data.thelook_ecommerce.events` e JOIN age_group ag ON e.user_id = ag.user_id JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.user_id = e.user_id GROUP BY e.traffic_source, ag.age_group ORDER BY total_revenue DESC",
    "description": "This query calculates the total revenue, grouped by the traffic source of user events and user age groups. It first categorizes users into specific age ranges and then joins this information with user events and order items to sum sale prices.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.users\", \"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.order_items\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"right_column\": \"id\", \"join_type\": \"INNER\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"INNER\"}]",
    "prompt_tokens": 388,
    "completion_tokens": 298,
    "total_tokens": 1952
  },
  {
    "query": "WITH users_with_events AS ( SELECT DISTINCT user_id FROM `bigquery-public-data.thelook_ecommerce.events` ), category_purchases AS ( SELECT DISTINCT oi.user_id, p.category FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id ) SELECT cp.category, COUNT(DISTINCT cp.user_id) AS buyers, COUNT(DISTINCT ue.user_id) AS total_users, SAFE_DIVIDE(COUNT(DISTINCT cp.user_id), COUNT(DISTINCT ue.user_id)) AS conversion_rate FROM users_with_events ue LEFT JOIN category_purchases cp ON ue.user_id = cp.user_id GROUP BY cp.category ORDER BY conversion_rate DESC",
    "description": "This query calculates the conversion rate for each product category. It compares the number of unique users who purchased an item in a specific category against the total number of unique users who had any event in the system.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 366,
    "completion_tokens": 298,
    "total_tokens": 3158
  },
  {
    "query": "WITH dc_revenue AS ( SELECT p.distribution_center_id AS dc_id, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY dc_id ), dc_events AS ( SELECT dc.id AS dc_id, COUNT(e.id) AS event_count FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc JOIN `bigquery-public-data.thelook_ecommerce.products` p ON p.distribution_center_id = dc.id JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.events` e ON e.user_id = oi.user_id GROUP BY dc.id ) SELECT dc.id AS distribution_center_id, dc.name, COALESCE(dr.revenue, 0) AS total_revenue, COALESCE(de.event_count, 0) AS total_events FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc LEFT JOIN dc_revenue dr ON dc.id = dr.dc_id LEFT JOIN dc_events de ON dc.id = de.dc_id ORDER BY total_revenue DESC",
    "description": "This query calculates the total revenue and the total number of associated events for each distribution center. It lists all distribution centers, displaying zero for revenue or events if no data is found for them, and orders the results by total revenue in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"bigquery-public-data.thelook_ecommerce.events\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"distribution_center_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"product_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 495,
    "completion_tokens": 497,
    "total_tokens": 3419
  },
  {
    "query": "WITH user_events AS ( SELECT user_id, COUNT(id) AS num_events FROM `bigquery-public-data.thelook_ecommerce.events` GROUP BY user_id ), user_orders AS ( SELECT user_id, COUNT(order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.orders` GROUP BY user_id ) SELECT u.gender, SUM(ue.num_events) AS total_events, SUM(uo.num_orders) AS total_orders, SAFE_DIVIDE(SUM(ue.num_events), SUM(uo.num_orders)) AS event_order_ratio FROM `bigquery-public-data.thelook_ecommerce.users` u LEFT JOIN user_events ue ON u.id = ue.user_id LEFT JOIN user_orders uo ON u.id = uo.user_id GROUP BY u.gender ORDER BY event_order_ratio DESC",
    "description": "This query calculates the total number of events and orders per user, then aggregates these by user gender to determine the total events, total orders, and the event-to-order ratio for each gender.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"user_id\", \"join_type\": \"LEFT\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"LEFT\"}]",
    "prompt_tokens": 378,
    "completion_tokens": 287,
    "total_tokens": 3229
  },
  {
    "query": "WITH product_revenue AS ( SELECT p.id AS product_id, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY product_id ), product_events AS ( SELECT p.id AS product_id, COUNT(e.id) AS num_events FROM `bigquery-public-data.thelook_ecommerce.products` p JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.events` e ON e.user_id = oi.user_id GROUP BY p.id ) SELECT p.id AS product_id, p.name, COALESCE(pr.revenue, 0) AS revenue, COALESCE(pe.num_events, 0) AS events FROM `bigquery-public-data.thelook_ecommerce.products` p LEFT JOIN product_revenue pr ON p.id = pr.product_id LEFT JOIN product_events pe ON p.id = pe.product_id ORDER BY revenue DESC LIMIT 50",
    "description": "This query calculates the total revenue for each product and counts the number of user events associated with purchasers of those products. It then retrieves the top 50 products by revenue, showing their name, total revenue, and the corresponding event count.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.events\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"product_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"id\", \"right_table\": \"product_revenue\", \"right_column\": \"product_id\", \"join_type\": \"LEFT JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"id\", \"right_table\": \"product_events\", \"right_column\": \"product_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 454,
    "completion_tokens": 536,
    "total_tokens": 4304
  },
  {
    "query": "SELECT e.traffic_source, p.category, AVG(oi.sale_price) AS avg_sale_price FROM `bigquery-public-data.thelook_ecommerce.events` e JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON e.user_id = oi.user_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY e.traffic_source, p.category ORDER BY avg_sale_price DESC",
    "description": "This query calculates the average sale price for products, categorized by the traffic source that led users to the site and the product's category. The results are ordered to show the highest average sale prices first.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 292,
    "completion_tokens": 298,
    "total_tokens": 1361
  },
  {
    "query": "WITH browser_events AS ( SELECT browser, COUNT(id) AS num_events FROM `bigquery-public-data.thelook_ecommerce.events` GROUP BY browser ), browser_orders AS ( SELECT e.browser, COUNT(DISTINCT o.order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.events` e JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON e.user_id = o.user_id GROUP BY e.browser ) SELECT be.browser, COALESCE(be.num_events, 0) AS events, COALESCE(bo.num_orders, 0) AS orders FROM browser_events be LEFT JOIN browser_orders bo ON be.browser = bo.browser ORDER BY events DESC",
    "description": "This query calculates the total number of events and unique orders for each browser type. It combines these metrics, presenting all browsers that have recorded events and showing zero for order counts if no orders are associated with a browser type.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.events\", \"bigquery-public-data.thelook_ecommerce.orders\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"left_column\": \"browser\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"browser\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 345,
    "completion_tokens": 276,
    "total_tokens": 4031
  },
  {
    "query": "WITH user_sale AS ( SELECT user_id, SUM(sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` GROUP BY user_id ), user_cost AS ( SELECT ii.user_id, SUM(ii.cost) AS cost FROM ( SELECT oi.user_id, ii.cost FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.inventory_items` ii ON oi.inventory_item_id = ii.id ) ii GROUP BY ii.user_id ) SELECT u.id AS user_id, COALESCE(us.revenue, 0) AS revenue, COALESCE(uc.cost, 0) AS cost, COALESCE(us.revenue, 0) - COALESCE(uc.cost, 0) AS profit FROM `bigquery-public-data.thelook_ecommerce.users` u LEFT JOIN user_sale us ON u.id = us.user_id LEFT JOIN user_cost uc ON u.id = uc.user_id ORDER BY profit DESC LIMIT 50",
    "description": "This query calculates the total revenue, cost, and net profit for each user by aggregating order item sales and inventory costs. It then identifies and displays the top 50 users with the highest profit.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"inventory_item_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"user_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 427,
    "completion_tokens": 386,
    "total_tokens": 4767
  },
  {
    "query": "WITH item_events AS ( SELECT ii.id AS inventory_item_id, COUNT(e.id) AS num_events FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON oi.inventory_item_id = ii.id JOIN `bigquery-public-data.thelook_ecommerce.events` e ON e.user_id = oi.user_id GROUP BY ii.id ) SELECT AVG(num_events) AS avg_events_per_item FROM item_events",
    "description": "This query calculates the average number of events associated with each inventory item. It first determines the total event count for each unique inventory item by linking inventory items to order items and then to user events, and then computes the overall average of these counts.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.events\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"inventory_item_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"user_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.events\", \"right_column\": \"user_id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 304,
    "completion_tokens": 312,
    "total_tokens": 1667
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(DISTINCT o.order_id) AS num_orders FROM `bigquery-public-data.thelook_ecommerce.orders` o JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON o.order_id = oi.order_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY num_orders DESC",
    "description": "This query calculates the total number of distinct orders for each distribution center. It joins orders, order items, products, and distribution centers to aggregate order counts by their associated distribution center.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 325,
    "completion_tokens": 399,
    "total_tokens": 1566
  },
  {
    "query": "SELECT a.id AS dc_a_id, a.name AS dc_a_name, b.id AS dc_b_id, b.name AS dc_b_name, ST_DISTANCE(a.distribution_center_geom, b.distribution_center_geom) AS distance_meters FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` a JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` b ON a.id < b.id ORDER BY distance_meters LIMIT 100",
    "description": "Error generating metadata: 504 Deadline Exceeded",
    "tables": [],
    "joins": [],
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0
  },
  {
    "query": "WITH reference_point AS ( SELECT ST_GEOGPOINT(-87.6298, 41.8781) AS ref_geom ) SELECT dc.id, dc.name, ST_DISTANCE(dc.distribution_center_geom, ref_geom) AS distance_meters FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc, reference_point ORDER BY distance_meters LIMIT 5",
    "description": "This query calculates the geographic distance from each distribution center to a fixed reference point (latitude 41.8781, longitude -87.6298) and returns the top 5 closest centers. It lists their ID, name, and calculated distance in meters.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[]",
    "prompt_tokens": 268,
    "completion_tokens": 106,
    "total_tokens": 2436
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, AVG(oi.sale_price) AS avg_sale_price FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY avg_sale_price DESC",
    "description": "This query calculates the average sale price of products for each distribution center. It joins order item data with product and distribution center information to group results by center and order them by the average sale price.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 298,
    "completion_tokens": 298,
    "total_tokens": 1423
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(ii.id) AS num_items FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON ii.product_distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY num_items DESC",
    "description": "This query counts the total number of inventory items for each distribution center. It returns the distribution center's ID, name, and the count of items, ordered by the number of items in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 267,
    "completion_tokens": 202,
    "total_tokens": 868
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, SUM(ii.cost) AS total_cost FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON ii.product_distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY total_cost DESC",
    "description": "This query calculates the total cost of all inventory items for each distribution center. It joins inventory items with distribution center information to display the distribution center's name and ID alongside the aggregated cost.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 267,
    "completion_tokens": 199,
    "total_tokens": 724
  },
  {
    "query": "-- This query approximates distance using the haversine formula via geography types WITH dc AS ( SELECT id, name, distribution_center_geom FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` WHERE name = 'Distribution Center A' ) SELECT u.id AS user_id, u.first_name, u.last_name, dc.name, ST_DISTANCE(dc.distribution_center_geom, ST_GEOGPOINT(u.longitude, u.latitude)) AS distance_meters FROM `bigquery-public-data.thelook_ecommerce.users` u, dc WHERE ST_DISTANCE(dc.distribution_center_geom, ST_GEOGPOINT(u.longitude, u.latitude)) <= 50000 ORDER BY distance_meters LIMIT 100",
    "description": "This query identifies the 100 users geographically closest to 'Distribution Center A'. It calculates the distance between each user's location and the specific distribution center, returning users within a 50,000-meter radius, ordered by increasing distance.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.users\", \"left_column\": \"longitude, latitude\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"distribution_center_geom\", \"join_type\": \"INNER\"}]",
    "prompt_tokens": 346,
    "completion_tokens": 209,
    "total_tokens": 3073
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, EXTRACT(YEAR FROM ii.sold_at) AS sold_year, EXTRACT(MONTH FROM ii.sold_at) AS sold_month, COUNT(ii.id) AS sold_count FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON ii.product_distribution_center_id = dc.id WHERE ii.sold_at IS NOT NULL GROUP BY distribution_center_id, dc.name, sold_year, sold_month ORDER BY sold_count DESC LIMIT 100",
    "description": "This query calculates the total count of sold inventory items for each distribution center, grouped by the year and month of sale. It then returns the top 100 distribution centers with the highest sales counts.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"left_column\": \"product_distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 321,
    "completion_tokens": 202,
    "total_tokens": 1049
  },
  {
    "query": "WITH dc_revenue AS ( SELECT p.distribution_center_id AS dc_id, SUM(oi.sale_price) AS revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id GROUP BY dc_id ), dc_cost AS ( SELECT ii.product_distribution_center_id AS dc_id, SUM(ii.cost) AS cost FROM `bigquery-public-data.thelook_ecommerce.inventory_items` ii GROUP BY dc_id ) SELECT dc.id AS distribution_center_id, dc.name, COALESCE(r.revenue, 0) AS revenue, COALESCE(c.cost, 0) AS cost, COALESCE(r.revenue, 0) - COALESCE(c.cost, 0) AS profit FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc LEFT JOIN dc_revenue r ON dc.id = r.dc_id LEFT JOIN dc_cost c ON dc.id = c.dc_id ORDER BY profit DESC",
    "description": "This query calculates the total revenue, cost, and profit for each distribution center. It aggregates revenue from order items and costs from inventory, then combines these with distribution center details to display overall profitability, ordered by profit.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.inventory_items\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"left_column\": \"id\", \"right_table\": \"dc_revenue\", \"right_column\": \"dc_id\", \"join_type\": \"LEFT JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"left_column\": \"id\", \"right_table\": \"dc_cost\", \"right_column\": \"dc_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 430,
    "completion_tokens": 384,
    "total_tokens": 3859
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name FROM `bigquery-public-data.thelook_ecommerce.distribution_centers` dc LEFT JOIN ( SELECT DISTINCT p.distribution_center_id FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.orders` o ON oi.order_id = o.order_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id WHERE o.created_at >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) ) recent_dc ON dc.id = recent_dc.distribution_center_id WHERE recent_dc.distribution_center_id IS NULL",
    "description": "This query identifies distribution centers that have not had any associated orders placed within the last 90 days. It does this by finding all distribution centers and then excluding those that appear in a subquery listing distribution centers with recent orders.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.products\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"left_column\": \"id\", \"right_table\": \"recent_dc\", \"right_column\": \"distribution_center_id\", \"join_type\": \"LEFT JOIN\"}]",
    "prompt_tokens": 344,
    "completion_tokens": 399,
    "total_tokens": 3319
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, p.category, SUM(oi.sale_price) AS total_revenue FROM `bigquery-public-data.thelook_ecommerce.order_items` oi JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name, p.category ORDER BY total_revenue DESC LIMIT 100",
    "description": "This query calculates the total revenue for each distribution center and product category. It returns the top 100 combinations by total revenue, ordered from highest to lowest.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 307,
    "completion_tokens": 292,
    "total_tokens": 1270
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, COUNT(DISTINCT o.user_id) AS num_users FROM `bigquery-public-data.thelook_ecommerce.orders` o JOIN `bigquery-public-data.thelook_ecommerce.order_items` oi ON o.order_id = oi.order_id JOIN `bigquery-public-data.thelook_ecommerce.products` p ON oi.product_id = p.id JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY num_users DESC",
    "description": "This query calculates the total number of unique users served by each distribution center. It joins several tables to link orders to products and ultimately to their distribution centers.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.orders\", \"bigquery-public-data.thelook_ecommerce.order_items\", \"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.orders\", \"left_column\": \"order_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"right_column\": \"order_id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.order_items\", \"left_column\": \"product_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}, {\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 325,
    "completion_tokens": 394,
    "total_tokens": 1501
  },
  {
    "query": "SELECT dc.id AS distribution_center_id, dc.name, AVG(p.cost) AS avg_product_cost FROM `bigquery-public-data.thelook_ecommerce.products` p JOIN `bigquery-public-data.thelook_ecommerce.distribution_centers` dc ON p.distribution_center_id = dc.id GROUP BY distribution_center_id, dc.name ORDER BY avg_product_cost DESC",
    "description": "This query calculates the average product cost for each distribution center. It aggregates product costs by distribution center ID and name, then orders the results by the average cost in descending order.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.products\", \"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[{\"left_table\": \"bigquery-public-data.thelook_ecommerce.products\", \"left_column\": \"distribution_center_id\", \"right_table\": \"bigquery-public-data.thelook_ecommerce.distribution_centers\", \"right_column\": \"id\", \"join_type\": \"INNER JOIN\"}]",
    "prompt_tokens": 267,
    "completion_tokens": 190,
    "total_tokens": 793
  },
  {
    "query": "SELECT ST_CENTROID(ST_UNION_AGG(distribution_center_geom)) AS all_dc_centroid FROM `bigquery-public-data.thelook_ecommerce.distribution_centers`",
    "description": "This query calculates the geographic centroid of the combined area of all distribution centers. It aggregates all individual distribution center geometries into a single unioned geometry before finding its central point.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.distribution_centers\"]",
    "joins": "[]",
    "prompt_tokens": 215,
    "completion_tokens": 82,
    "total_tokens": 525
  },
  {
    "query": "WITH reference_point AS ( SELECT ST_GEOGPOINT(-87.6298, 41.8781) AS ref_geom ), user_dist AS ( SELECT u.id AS user_id, ST_DISTANCE(ref_geom, ST_GEOGPOINT(u.longitude, u.latitude)) / 1000 AS distance_km FROM `bigquery-public-data.thelook_ecommerce.users` u, reference_point ) SELECT CASE WHEN distance_km < 10 THEN '<10km' WHEN distance_km BETWEEN 10 AND 50 THEN '10-50km' WHEN distance_km BETWEEN 50 AND 100 THEN '50-100km' ELSE '>100km' END AS distance_bucket, COUNT(*) AS num_users FROM user_dist GROUP BY distance_bucket ORDER BY num_users DESC",
    "description": "This query calculates the geographical distance of each user from a fixed reference point (Chicago's Willis Tower) and categorizes users into predefined distance buckets. It then counts the total number of users within each distance bucket.",
    "tables": "[\"bigquery-public-data.thelook_ecommerce.users\"]",
    "joins": "[]",
    "prompt_tokens": 370,
    "completion_tokens": 89,
    "total_tokens": 1404
  }
]