{
  "table_analysis": {
    "actual_tables": [
      "bigquery-public-data.thelook_ecommerce.users",
      "bigquery-public-data.thelook_ecommerce.order_items"
    ],
    "cte_tables": [
      "user_spending",
      "ranked_spending"
    ],
    "table_aliases": [
      {
        "alias": "t1",
        "table": "bigquery-public-data.thelook_ecommerce.users"
      },
      {
        "alias": "t2",
        "table": "bigquery-public-data.thelook_ecommerce.order_items"
      }
    ],
    "subquery_tables": []
  },
  "column_analysis": {
    "columns": [
      {
        "table": "bigquery-public-data.thelook_ecommerce.users",
        "column": "id"
      },
      {
        "table": "bigquery-public-data.thelook_ecommerce.users",
        "column": "first_name"
      },
      {
        "table": "bigquery-public-data.thelook_ecommerce.users",
        "column": "last_name"
      },
      {
        "table": "bigquery-public-data.thelook_ecommerce.order_items",
        "column": "sale_price"
      },
      {
        "table": "bigquery-public-data.thelook_ecommerce.order_items",
        "column": "user_id"
      }
    ],
    "column_aliases": [
      {
        "alias": "user_id",
        "column": "t1.id"
      },
      {
        "alias": "total_spent",
        "column": "SUM(t2.sale_price)"
      },
      {
        "alias": "rank_most_spent",
        "column": "RANK() OVER (ORDER BY total_spent DESC)"
      },
      {
        "alias": "rank_least_spent",
        "column": "RANK() OVER (ORDER BY total_spent ASC)"
      },
      {
        "alias": "spending_category",
        "column": "CASE WHEN rank_most_spent = 1 THEN 'Most Spent' WHEN rank_least_spent = 1 THEN 'Least Spent' END"
      }
    ],
    "aggregate_columns": [
      "SUM(t2.sale_price)"
    ],
    "computed_columns": [
      "t1.id AS user_id",
      "SUM(t2.sale_price) AS total_spent",
      "RANK() OVER (ORDER BY total_spent DESC) AS rank_most_spent",
      "RANK() OVER (ORDER BY total_spent ASC) AS rank_least_spent",
      "CASE WHEN rank_most_spent = 1 THEN 'Most Spent' WHEN rank_least_spent = 1 THEN 'Least Spent' END AS spending_category"
    ]
  },
  "analysis_time": 2.101270914077759,
  "tokens_used": 1600,
  "cost_estimate": 0.00011999999999999999
}