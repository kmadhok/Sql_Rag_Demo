{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import{chatService}from'../services/chatService';import{dataService}from'../services/dataService';const initialState={conversations:{},currentSessionId:null,isLoading:false,error:null,agentType:'normal',messages:[],sqlResults:null};export const sendMessage=createAsyncThunk('chat/sendMessage',async request=>{const response=await chatService.sendMessage(request);return response;});export const executeSQL=createAsyncThunk('chat/executeSQL',async request=>{const response=await dataService.executeQuery({sql:request.sql,dryRun:request.dryRun});return response;});const chatSlice=createSlice({name:'chat',initialState,reducers:{setAgentType:(state,action)=>{state.agentType=action.payload;},setCurrentSession:(state,action)=>{state.currentSessionId=action.payload;},addMessage:(state,action)=>{state.messages.push(action.payload);},clearMessages:state=>{state.messages=[];},clearError:state=>{state.error=null;}},extraReducers:builder=>{builder.addCase(sendMessage.pending,state=>{state.isLoading=true;state.error=null;}).addCase(sendMessage.fulfilled,(state,action)=>{state.isLoading=false;// Convert ChatResponse to Message\nconst timestampStr=typeof action.payload.timestamp==='string'?action.payload.timestamp:new Date(action.payload.timestamp).toISOString();const message={id:timestampStr||Date.now().toString(),content:action.payload.message,role:'assistant',timestamp:action.payload.timestamp,sqlQuery:action.payload.sqlQuery,sqlResult:action.payload.sqlResult,sources:action.payload.sources,tokenUsage:action.payload.tokenUsage,contextUtilization:action.payload.contextUtilization,agentUsed:action.payload.agentUsed};state.messages.push(message);}).addCase(sendMessage.rejected,(state,action)=>{state.isLoading=false;state.error=action.error.message||'Failed to send message';}).addCase(executeSQL.pending,state=>{state.isLoading=true;state.error=null;}).addCase(executeSQL.fulfilled,(state,action)=>{state.isLoading=false;state.sqlResults=action.payload;}).addCase(executeSQL.rejected,(state,action)=>{state.isLoading=false;state.error=action.error.message||'Failed to execute SQL';});}});export const{setAgentType,setCurrentSession,addMessage,clearMessages,clearError}=chatSlice.actions;export default chatSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","chatService","dataService","initialState","conversations","currentSessionId","isLoading","error","agentType","messages","sqlResults","sendMessage","request","response","executeSQL","executeQuery","sql","dryRun","chatSlice","name","reducers","setAgentType","state","action","payload","setCurrentSession","addMessage","push","clearMessages","clearError","extraReducers","builder","addCase","pending","fulfilled","timestampStr","timestamp","Date","toISOString","message","id","now","toString","content","role","sqlQuery","sqlResult","sources","tokenUsage","contextUtilization","agentUsed","rejected","actions","reducer"],"sources":["/Users/kanumadhok/Downloads/code/Sql_Rag_Demo/SQL_RAG/rag_app/frontend/src/store/chatSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport { Message, Conversation, ChatRequest, ChatResponse, ExecuteSQLResponse } from '../types/api';\nimport { chatService } from '../services/chatService';\nimport { dataService } from '../services/dataService';\n\ninterface ChatState {\n  conversations: Record<string, Conversation>;\n  currentSessionId: string | null;\n  isLoading: boolean;\n  error: string | null;\n  agentType: string;\n  messages: Message[];\n  sqlResults: ExecuteSQLResponse | null;\n}\n\nconst initialState: ChatState = {\n  conversations: {},\n  currentSessionId: null,\n  isLoading: false,\n  error: null,\n  agentType: 'normal',\n  messages: [],\n  sqlResults: null,\n};\n\nexport const sendMessage = createAsyncThunk(\n  'chat/sendMessage',\n  async (request: ChatRequest) => {\n    const response = await chatService.sendMessage(request);\n    return response;\n  }\n);\n\nexport const executeSQL = createAsyncThunk(\n  'chat/executeSQL',\n  async (request: { sql: string; dryRun?: boolean }) => {\n    const response = await dataService.executeQuery({\n      sql: request.sql,\n      dryRun: request.dryRun\n    });\n    return response;\n  }\n);\n\nconst chatSlice = createSlice({\n  name: 'chat',\n  initialState,\n  reducers: {\n    setAgentType: (state, action: PayloadAction<string>) => {\n      state.agentType = action.payload;\n    },\n    setCurrentSession: (state, action: PayloadAction<string>) => {\n      state.currentSessionId = action.payload;\n    },\n    addMessage: (state, action: PayloadAction<Message>) => {\n      state.messages.push(action.payload);\n    },\n    clearMessages: (state) => {\n      state.messages = [];\n    },\n    clearError: (state) => {\n      state.error = null;\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(sendMessage.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(sendMessage.fulfilled, (state, action) => {\n        state.isLoading = false;\n        // Convert ChatResponse to Message\n        const timestampStr = typeof action.payload.timestamp === 'string' \n          ? action.payload.timestamp \n          : new Date(action.payload.timestamp).toISOString();\n          \n        const message: Message = {\n          id: timestampStr || Date.now().toString(),\n          content: action.payload.message,\n          role: 'assistant',\n          timestamp: action.payload.timestamp,\n          sqlQuery: action.payload.sqlQuery,\n          sqlResult: action.payload.sqlResult,\n          sources: action.payload.sources,\n          tokenUsage: action.payload.tokenUsage,\n          contextUtilization: action.payload.contextUtilization,\n          agentUsed: action.payload.agentUsed,\n        };\n        state.messages.push(message);\n      })\n      .addCase(sendMessage.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.error.message || 'Failed to send message';\n      })\n      .addCase(executeSQL.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(executeSQL.fulfilled, (state, action) => {\n        state.isLoading = false;\n        state.sqlResults = action.payload;\n      })\n      .addCase(executeSQL.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.error.message || 'Failed to execute SQL';\n      });\n  },\n});\n\nexport const { setAgentType, setCurrentSession, addMessage, clearMessages, clearError } = chatSlice.actions;\nexport default chatSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}